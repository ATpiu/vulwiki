# 短文件名泄漏漏洞

### 漏洞等级

中危

### 漏洞描述

该漏洞由于Windows处理较长文件名时为方便使用较短的文件名代替，攻击者可利用该漏洞尝试获取网站服务器下的文件名。

### 漏洞危害

黑客可通过该漏洞尝试获取网站服务器下存放文件的文件名，达到获取更多信息来入侵服务器的目的。

### 修复建议

- 修改Windows配置，关闭短文件名功能。
- 部署Web应用防火墙，防止攻击者批量尝试。

### 漏洞描述

为了兼容16位MS-DOS程序，Windows为文件名较长的文件（和文件夹）生成了对应的windows 8.3 短文件名，而生成的短文件名符合一定的规律，可以被暴力猜解。

### 漏洞检测

需要使用到通配符*，在windows中，*可以匹配n个字符，n可以为0。判断某站点是否存在IIS短文件名暴力破解漏洞，可以分别访问如下两个URL:

1. [http://localhost/\*~1\*\*\*\*/a.aspx](http://localhost//*~1/*/*/*/*/a.aspx)
2. [http://localhost/l1j1e\*~1\*\*\*\*/a.aspx](http://localhost/l1j1e/*~1/*/*/*/*/a.aspx)

这里我使用了4个星号，主要是为了程序自动化猜解，逐个猜解后缀名中的3个字符，实际上，一个星号与4个星号没有任何区别（上面已经提到，*号可以匹配空）。

**如果访问第一个URL，返回404。而访问第二个URL，返回400。 则目标站点存在漏洞。**

### 漏洞危害

1. 猜解后台地址
2. 猜解敏感文件，例如备份的rar、zip、.bak、.SQL文件等。
3. 在某些情形下，甚至可以通过短文件名web直接下载对应的文件。比如下载备份SQL文件。

### 漏洞修复

1. 升级.net framework
2. 修改注册表键值：

> HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem

修改NtfsDisable8dot3NameCreation为1。再新建文件夹，将原网站目录内容拷贝进入新建的文件夹，使用新建的文件夹作为网站目录。